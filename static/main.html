<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="stylesheet" href="css/context.css">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/tree.css">
	<link rel="stylesheet" href="css/timeseries.css">
	<link rel="stylesheet" href="css/tooltip.css">
			<!-- Bootstrap core CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/simple-sidebar.css" rel="stylesheet">
	<link href="css/contextmenu/d3-context-menu.css" rel="stylesheet">
	<link href="css/tablestyle.css" rel="stylesheet">
	
			<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
	<title>Twitter Navigator</title>

	<!--external resources-->
	<!-- jquery ui-->
	<script type="text/javascript" src="lib/jQuery/jquery-2.1.3.min.js"></script>
	<script type="text/javascript" src="lib/jquery-ui-1.11.4/jquery-ui.js"></script>
	<link rel="stylesheet" href="lib/jquery-ui-1.11.4/jquery-ui.css">
	<script type="text/javascript" src="lib/numeric-1.2.6.min.js"></script>
	<script type="text/javascript" src="lib/d3/d3.min.js" charset="utf-8"></script>

	<script type="text/javascript" src="lib/underscore.js"></script>

	<script type="text/javascript" src="lib/contextmenu/d3-context-menu.js"></script>
	<script type="text/javascript" src="lib/xDate.js"></script>
	<script type="text/javascript" src="lib/bootstrap/bootstrap.js"></script>

	<!--d3 tooltip-->
	<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

	<!-- spatial clustering--><!-- 
	<script type="text/javascript" src="lib/node_modules/density-clustering/lib/DBSCAN.js"></script>
	<script type="text/javascript" src="src/Model/SpatialClustering.js"></script> -->

	<!-- spatial analysis toolkit: TURF.JS -->
	<!--<script type="text/javascript" src="http://api.tiles.mapbox.com/mapbox.js/plugins/turf/v2.0.0/turf.min.js"></script> -->
	
	<!-- spatial clustering-->
	<script type="text/javascript" src="src/Model/HullLayout.js"></script>
	<script type="text/javascript" src="src/Model/PolyK.js"></script>

	<script type="text/javascript" src="src/Vis/colorFuncCollection.js"></script>
	<script type="text/javascript" src="src/Vis/miscFuncCollection.js"></script>


	<script type="text/javascript" src="src/Model/Obj.js"></script>
	<!--extend d3-->
	<script type="text/javascript" src="constant.js"></script>

	<script type="text/javascript" src="lib/OpenLayers-2.13.1/OpenLayers.js"></script>

    <script type="text/javascript" src="lib/taffydb-master/taffy.js"></script>

	<script type="text/javascript" src="src/Vis/OlMapView.js"></script>
	<script type="text/javascript" src="src/Vis/OlMapViewHelper.js"></script>

	<script type="text/javascript" src="src/Vis/TweetsHeatmapManager.js"></script>
	<script type="text/javascript" src="src/Vis/PolygonLayerManager.js"></script>

	<script type="text/javascript" src="src/Vis/Canvas_manager.js"></script>

	<script type="text/javascript" src="src/Model/CTreeNode.js"></script>
	<script type="text/javascript" src="src/Model/DataCenter.js"></script>

	<script type="text/javascript" src="src/Vis/contour/ContourVis.js"></script>

	<script type="text/javascript" src="lib/heatmap/heatmap.js"></script>
	<script type="text/javascript" src="lib/heatmap/heatmap-openlayers-renderer.js"></script>

	<script type="text/javascript" src="src/Model/EMTerms.js"></script>

	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular.min.js"></script>
	<script type="text/javascript" src="src/Controller/app_controller.js"></script>
	<script type="text/javascript" src="src/Controller/autoresize_directive.js"></script>

	<script type="text/javascript" src="src/Model/TweetsDataManager.js"></script>

	<script type="text/javascript" src="src/Vis/Tree/EMTree.js"></script>

	<script type="text/javascript" src="src/Vis/Time-series/multi-timeseries.js"></script>
	<script type="text/javascript" src="src/Vis/Time-series/timeseriesmanager.js"></script>

	<script type="text/javascript" src="src/Vis/table/EMTable.js"></script>

	<!-- Concave Hull -->
	<script type="text/javascript" src="lib/hull-master/dist/hull.js"></script>

	<script type="text/javascript" src="http://requirejs.org/docs/release/2.1.22/minified/require.js"></script>

	<!--scale tree-->
	<script type="text/javascript" src="src/Vis/ScaleTree/ScaleTreeCanvas.js"></script>

	<style>

	text {
		
		font-family: "Trebuchet MS", Helvetica, sans-serif;
		cursor: pointer;
	}

	h4 {
		
		font-family: "Trebuchet MS", Helvetica, sans-serif;
		font-size: 22px;

	}
	select {
		
		font-family: "Trebuchet MS", Helvetica, sans-serif;

	}
	input {
		
		font-family: "Trebuchet MS", Helvetica, sans-serif;

	}
	h5 {
		
		font-family: "Trebuchet MS", Helvetica, sans-serif;
		font-size: 18px;

	}

	span {

		font-family: "Trebuchet MS", Helvetica, sans-serif;
	}

	.concaveHull {
		cursor: pointer;
	}
	.hull {
	  fill: none;
	  stroke: steelblue;
	  stroke-width: 2px;
	  stroke-linejoin: round;
	}

	.line {
	  fill: none;
	  stroke: steelblue;
	  stroke-width: 1.5px;
	}

	.treeNode:hover {
		cursor: pointer;
	}

	</style>

	<script type="text/javascript">

		// $(function() {
		// 	$("#EM_Tree_container").draggable();
		// });

		// $(function() {
  //   		$( "#EM_Tree_container" ).draggable({ cancel: "div.noSupportDrag" });
  // 		});

  		$(function() {
			$("#ScaleTreeContainer").draggable();
		});

		$(function() {
    		$( "#ScaleTreeContainer" ).draggable({ cancel: "div.noSupportDrag" });
  		});

  // 		$(function() {
		// 	$("#table_container").draggable();
		// });

		// $(function() {
  //   		$( "#table_container" ).draggable({ cancel: "div.noSupportDrag" });
  // 		});

		$(function() {
			$("#controlpanel").draggable();
		});

		// $(function() {
		// 	$("#timeseries").draggable();
		// });

		// $(function() {
  //   		$( "#timeseries" ).draggable({ cancel: "div.noSupportDrag" });
  // 		});
		
		// $(function() {
		// 	$("#timeseries").draggable();
		// });
		//var person = prompt("Please enter a number, 0 for purdue shooting, 1 for boston bombing, 2 for hurricane sandy", "1");
    
    	//if (person != null){
        	//default_case = parseInt(person);

			// var r = confirm("Press OK to load real-time mode, and Cancel to load historical mode");
	  //   	if (r == true) {
	  //       	setTimeout(function(){ enable_realtime(); }, 3000);
	  //   	} else {
	  //       	setTimeout(function(){ enable_his(); }, 3000);
	  //   	}
	  default_case = 1;
	  setTimeout(function(){ enable_his(); }, 1000);
	    //}

		function enable_his() {
			var data = case_study[default_case];
			var bounds = [ {x:data.min_x, y:data.min_y},{x:data.max_x, y:data.max_y}];
			$('[ng-controller="map_controller"]').scope().add_region_to_canvas(bounds, data.start_time, data.end_time);
			//$('[ng-controller="map_controller"]').scope().load_data(data.start_time, data.end_time, true);
			$('[ng-controller="map_controller"]').scope().updateGeoBbox();
		}

		// function enable_realtime(){

		// 	var data = case_study[default_case];
		// 	var bounds = [ {x:data.min_x, y:data.min_y},{x:data.max_x, y:data.max_y}];

		// 	$('[ng-controller="map_controller"]').scope().add_region_to_canvas(bounds, data.start_time, data.end_time);
			
		// 	var start_date = new Date(Date.parse(case_study[default_case].start_time));

		// 	globe.x_start = new XDate(start_date);
		// 	globe.x_end = new XDate(start_date);

		// 	//utc issue;
		// 	globe.x_start.addHours(case_study[default_case].time_offset);
		// 	globe.x_end.addHours(case_study[default_case].time_offset);
			
		// 	globe.x_end.addSeconds(globe.data_inc);

		// 	start_timing();

		// }

		// function start_timing(){
			
		// 	if(globe.interval_id != null)
		// 		return;

		// 	globe.interval_id = setInterval(function(){

		// 		var s = globe.x_start.toString("i")+"Z";
		// 		var e = globe.x_end.toString("i")+"Z";

		// 		if(globe.flag == true){
		// 			$('[ng-controller="map_controller"]').scope().load_data(s, e, true);
		// 			$('[ng-controller="map_controller"]').scope().refresh_map(false);
		// 		}else
		// 			$('[ng-controller="map_controller"]').scope().load_data(s, e, false);

		// 		console.log("real-time mode: "+ s + ", " + e);

		// 		//alert(s+" "+e+" "+flag);

		// 		globe.flag = false;
				
		// 		//move slide bar;
		// 		var slide_start = new XDate(globe.x_end);
		// 		slide_start.addMinutes(-1*globe.time_window);
		// 		slide_start.addHours(-4);

		// 		//time zone change;
		// 		var tmp_e = new XDate(globe.x_end);
		// 		tmp_e.addHours(-4);
				
		// 		$('[ng-controller="ts_controller"]').scope().set_time_range_manually(slide_start, tmp_e);
				
		// 		globe.x_start.addSeconds(globe.data_inc);
		// 		globe.x_end.addSeconds(globe.data_inc);

		// 	}, globe.data_fetch_timing*1000);
		// }

		// function stop_timing(){

		// 	if(globe.interval_id == null)
		// 		return;

		// 	clearInterval(globe.interval_id);
		// 	globe.interval_id = null;

		// }

		function changemode(val){
			ContourVis.MODE = val;
			$('[ng-controller="app_controller"]').scope().masterUpdate();
		}

		function changeTension(val){
			if(parseInt(val) == 1)
				ContourVis.tension += 0.1;
			else
				ContourVis.tension -= 0.1;
			$('[ng-controller="app_controller"]').scope().masterUpdate();
		}

		function sortTree(val){
			if(parseInt(val) == 0)
				CTreeNode.SORT = CTreeNode.SORTMODE.VOLUME;
			else if(parseInt(val) == 1)
				CTreeNode.SORT = CTreeNode.SORTMODE.GEO;
			else if(parseInt(val) == 2)
				CTreeNode.SORT = CTreeNode.SORTMODE.STAT;

			DataCenter.instance().getTree().sortChildren();
			$('[ng-controller="app_controller"]').scope().masterUpdate();

		}

	</script>

</head>
<!-- onload="init()"  -->
	<body ng-app="twittNavApp" ng-controller="app_controller">

	<div id="ScaleTreeContainer" style="left:1100px;top:50px;width:700px;height:700px;position:absolute;background-color: rgba(247, 251, 255, 1.0);overflow:hidden;z-index:99;border:2px solid #999;text-align:center;">
	
	<h4 align="center" style="cursor: pointer">Scale Tree</h4>

	<!--background-color: rgba(247, 251, 255, 0.6);-->
		<div style="width:600px;height:600px;margin: 0 auto;" class="noSupportDrag">
			<div id="ScaleTreeCanvasView" style="width:600px;height:600px;" ng-controller="ScaleTreeCtrl"></div>
		</div>
	</div>



	<!--<div id="EM_Tree" style="left:50px;top:400px;width:700px;height:420px;position:absolute;background-color: rgba(247, 251, 255, 0.6);overflow:hidden;z-index:99999;border:2px solid #999;" ng-controller="EMTree_controller"></div>-->

	<div id="mapView" ng-controller="map_controller" style="height:1024px;width:1024px;"></div>
	<!-- <div id="mapViewHelper" style="height:2048px;width:2048px;position:absolute;display:none;"></div> -->
	<!-- <div id="mapViewHelper" style="height:200%;width:200%;position:relative;z-index:99999;"></div> -->


	<div id="controlpanel" style="left:50px;top:50px;width:180px;height:350px;position:absolute;background-color: rgba(247, 251, 255, 1.0);overflow:hidden;z-index:99999;border:2px solid #999;text-align:center;overflow: scroll;">
		<!-- onmouseover="$('#controlpanel').css('overflow-y', 'scroll');" onmouseout="$('#controlpanel').css('overflow-y', 'hidden');" -->
		<h4 align="center" style="cursor: pointer">Control Panel</h4>

		<h5 align="center">Sort tree:</h5>
			<div>
				<input type="radio" name="sortTree" onclick="sortTree(0);" ><span>volume</span><br>
				<input type="radio" name="sortTree" onclick="sortTree(1);" checked><span>geolocation(lon)</span><br>
				<input type="radio" name="sortTree" onclick="sortTree(2);" ><span>stat score</span>

			</div>
		
		<h5 align="center">Edit contour:</h5>
			<div>
				<input type="radio" name="mode" onclick="changemode(0);"><span>basis</span>
				<input type="radio" name="mode" onclick="changemode(1);" checked><span>cardinal</span>
				<button onclick="changeTension(1)">inc tension</button>
				<button onclick="changeTension(0)">dec tension</button><br>
			</div>
			
			<!-- <h5 align="center">Search:</h5>
			<input type="text" name="search" size="10"><br>

			<h5 align="center">Glyph Type</h5>
		    <select name="glyphType" ng-model="data.glyphType" ng-change="glyph_change()">
		      <option value="0">Option A</option>
		      <option value="1">Option B</option>
		      <option value="2">Option C</option>
		    </select><br>

			<h5 align="center">Display Mode</h5>
		    <select name="glyphType" ng-model="data.displayMode" ng-change="display_mode_change()">
				<option value="0">all</option>
				<option value="1">glyph</option>
				<option value="2">heatmap</option>
				<option value="3">dot</option>
		    </select><br>
			<h5 align="center">Real-time Options</h5>
		    <input type="radio" ng-model="data.realtime_mode" value="resume" ng-change="realtime_mode_change()"><span>resume</span><br>
		    <input type="radio" ng-model="data.realtime_mode" value="stop" ng-change="realtime_mode_change()"><span>stop</span><br>
		    
		    <span align="center">Time Window:</span>
    		 <select name="singleSelect" id="singleSelect" ng-model="data.time_window" width="110" style="width:110px" ng-change="time_window_change()">
		      <option value="10">&nbsp;&nbsp;&nbsp;&nbsp;10</option>
		      <option value="30" selected="selected">&nbsp;&nbsp;&nbsp;&nbsp;30</option>
		      <option value="60">&nbsp;&nbsp;&nbsp;&nbsp;60</option>
		    </select><br>

		    <h5 align="center">Spatial Transition</h5>
		    <span align="center">Convex hull:</span>
    			<input type="checkbox" ng-model="data.showHull" ng-change="null_change()"><br/>

    		<span align="center">Spatial transition:</span>
    			<input type="checkbox" ng-model="data.transition" ng-change="transition_change()"><br/>

    		<span align="center">Glyph Size</span>
    			<button onclick="increaseSize()">Increase</button><button onclick="decreaseSize()">Decrease</button> -->


	</div>

</body>
</html>