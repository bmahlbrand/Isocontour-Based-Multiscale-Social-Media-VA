<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="stylesheet" href="css/context.css">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/tree.css">
	<link rel="stylesheet" href="css/timeseries.css">
	<link rel="stylesheet" href="css/tooltip.css">
			<!-- Bootstrap core CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/simple-sidebar.css" rel="stylesheet">
	<link href="css/contextmenu/d3-context-menu.css" rel="stylesheet">
	<link href="css/tablestyle.css" rel="stylesheet">
	
			<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
	<title>Twitter Navigator</title>

	<script type="text/javascript">
		Array.prototype.max = function() {
		  return Math.max.apply(null, this);
		};

		Array.prototype.min = function() {
		  return Math.min.apply(null, this);
		};
	</script>

	<!--external resources-->
	<!-- jquery ui-->
	<script type="text/javascript" src="lib/jQuery/jquery-2.1.3.min.js"></script>
	<script type="text/javascript" src="lib/jquery-ui-1.11.4/jquery-ui.js"></script>
	<link rel="stylesheet" href="lib/jquery-ui-1.11.4/jquery-ui.css">
	<script type="text/javascript" src="lib/numeric-1.2.6.min.js"></script>
	<script type="text/javascript" src="lib/d3/d3.min.js" charset="utf-8"></script>

	<script type="text/javascript" src="lib/underscore.js"></script>

	<script type="text/javascript" src="lib/contextmenu/d3-context-menu.js"></script>
	<script type="text/javascript" src="lib/xDate.js"></script>
	<script type="text/javascript" src="lib/bootstrap/bootstrap.js"></script>

	<!--d3 tooltip-->
	<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

	<!-- spatial clustering--><!-- 
	<script type="text/javascript" src="lib/node_modules/density-clustering/lib/DBSCAN.js"></script>
	<script type="text/javascript" src="src/Model/SpatialClustering.js"></script> -->

	<!-- spatial analysis toolkit: TURF.JS -->
	<!--<script type="text/javascript" src="http://api.tiles.mapbox.com/mapbox.js/plugins/turf/v2.0.0/turf.min.js"></script> -->
	
	<!-- spatial clustering-->
	<script type="text/javascript" src="src/Model/HullLayout.js"></script>
	<script type="text/javascript" src="src/Model/PolyK.js"></script>

	<script type="text/javascript" src="src/Vis/colorFuncCollection.js"></script>
	<script type="text/javascript" src="src/Vis/miscFuncCollection.js"></script>


	<script type="text/javascript" src="src/Model/Obj.js"></script>
	<!--extend d3-->
	<script type="text/javascript" src="constant.js"></script>

	<script type="text/javascript" src="lib/OpenLayers-2.13.1/OpenLayers.js"></script>

    <script type="text/javascript" src="lib/taffydb-master/taffy.js"></script>

	<script type="text/javascript" src="src/Vis/OlMapView.js"></script>
	<script type="text/javascript" src="src/Vis/OlMapViewHelper.js"></script>

	<script type="text/javascript" src="src/Vis/TweetsHeatmapManager.js"></script>
	<script type="text/javascript" src="src/Vis/PolygonLayerManager.js"></script>

	<script type="text/javascript" src="src/Vis/Canvas_manager.js"></script>

	<script type="text/javascript" src="src/Model/CTreeNode.js"></script>
	<script type="text/javascript" src="src/Model/DataCenter.js"></script>

	<script type="text/javascript" src="src/Vis/contour/ContourVis.js"></script>

	<script type="text/javascript" src="lib/heatmap/heatmap.js"></script>
	<script type="text/javascript" src="lib/heatmap/heatmap-openlayers-renderer.js"></script>

	<script type="text/javascript" src="src/Model/EMTerms.js"></script>

	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular.min.js"></script>
	<script type="text/javascript" src="src/Controller/app_controller.js"></script>
	<script type="text/javascript" src="src/Controller/autoresize_directive.js"></script>

	<script type="text/javascript" src="src/Model/TweetsDataManager.js"></script>

	<script type="text/javascript" src="src/Vis/Tree/EMTree.js"></script>

	<script type="text/javascript" src="src/Vis/Time-series/multi-timeseries.js"></script>
	<script type="text/javascript" src="src/Vis/Time-series/timeseriesmanager.js"></script>

	<script type="text/javascript" src="src/Vis/table/EMTable.js"></script>

	<!-- Concave Hull -->
	<script type="text/javascript" src="lib/hull-master/dist/hull.js"></script>

	<script type="text/javascript" src="lib/require.js"></script>

	<!--scale tree-->
	<script type="text/javascript" src="src/Vis/ScaleTree/ScaleTreeCanvas.js"></script>

	<style>

	text {
		
		font-family: "Trebuchet MS", Helvetica, sans-serif;
		cursor: pointer;
	}

	h4 {
		
		font-family: "Trebuchet MS", Helvetica, sans-serif;
		font-size: 18px;

	}
	select {
		
		font-family: "Trebuchet MS", Helvetica, sans-serif;

	}
	input {
		
		font-family: "Trebuchet MS", Helvetica, sans-serif;

	}
	h5 {
		
		font-family: "Trebuchet MS", Helvetica, sans-serif;
		font-size: 16px;

	}

	h6 {
		
		font-family: "Trebuchet MS", Helvetica, sans-serif;
		font-size: 12px;

	}
	span {

		font-family: "Trebuchet MS", Helvetica, sans-serif;
	}

	.concaveHull {
		cursor: pointer;
	}
	.hull {
	  fill: none;
	  stroke: steelblue;
	  stroke-width: 2px;
	  stroke-linejoin: round;
	}

	.line {
	  fill: none;
	  stroke: steelblue;
	  stroke-width: 1.5px;
	}

	.treeNode:hover {
		cursor: pointer;
	}

	</style>

	<script type="text/javascript">


  // 		$(function() {
		// 	$("#ScaleTreeContainer").draggable();
		// });

		// $(function() {
  //   		$( "#ScaleTreeContainer" ).draggable({ cancel: "div.noSupportDrag" });
  // 		});


		// $(function() {
		// 	$("#controlpanel").draggable();
		// });


		//var person = prompt("Please enter a number, 0 for purdue shooting, 1 for boston bombing, 2 for hurricane sandy", "1");
    
    	//if (person != null){
        	//default_case = parseInt(person);

			// var r = confirm("Press OK to load real-time mode, and Cancel to load historical mode");
	  //   	if (r == true) {
	  //       	setTimeout(function(){ enable_realtime(); }, 3000);
	  //   	} else {
	  //       	setTimeout(function(){ enable_his(); }, 3000);
	  //   	}
	  default_case = 1;
	  setTimeout(function(){ enable_his(); }, 1000);
	    //}

		function enable_his() {
			var data = case_study[default_case];
			var bounds = [ {x:data.min_x, y:data.min_y},{x:data.max_x, y:data.max_y}];
			$('[ng-controller="map_controller"]').scope().add_region_to_canvas(bounds, data.start_time, data.end_time);
			//$('[ng-controller="map_controller"]').scope().load_data(data.start_time, data.end_time, true);
			$('[ng-controller="map_controller"]').scope().updateGeoBbox();
		}

		// function enable_realtime(){

		// 	var data = case_study[default_case];
		// 	var bounds = [ {x:data.min_x, y:data.min_y},{x:data.max_x, y:data.max_y}];

		// 	$('[ng-controller="map_controller"]').scope().add_region_to_canvas(bounds, data.start_time, data.end_time);
			
		// 	var start_date = new Date(Date.parse(case_study[default_case].start_time));

		// 	globe.x_start = new XDate(start_date);
		// 	globe.x_end = new XDate(start_date);

		// 	//utc issue;
		// 	globe.x_start.addHours(case_study[default_case].time_offset);
		// 	globe.x_end.addHours(case_study[default_case].time_offset);
			
		// 	globe.x_end.addSeconds(globe.data_inc);

		// 	start_timing();

		// }

		// function start_timing(){
			
		// 	if(globe.interval_id != null)
		// 		return;

		// 	globe.interval_id = setInterval(function(){

		// 		var s = globe.x_start.toString("i")+"Z";
		// 		var e = globe.x_end.toString("i")+"Z";

		// 		if(globe.flag == true){
		// 			$('[ng-controller="map_controller"]').scope().load_data(s, e, true);
		// 			$('[ng-controller="map_controller"]').scope().refresh_map(false);
		// 		}else
		// 			$('[ng-controller="map_controller"]').scope().load_data(s, e, false);

		// 		console.log("real-time mode: "+ s + ", " + e);

		// 		//alert(s+" "+e+" "+flag);

		// 		globe.flag = false;
				
		// 		//move slide bar;
		// 		var slide_start = new XDate(globe.x_end);
		// 		slide_start.addMinutes(-1*globe.time_window);
		// 		slide_start.addHours(-4);

		// 		//time zone change;
		// 		var tmp_e = new XDate(globe.x_end);
		// 		tmp_e.addHours(-4);
				
		// 		$('[ng-controller="ts_controller"]').scope().set_time_range_manually(slide_start, tmp_e);
				
		// 		globe.x_start.addSeconds(globe.data_inc);
		// 		globe.x_end.addSeconds(globe.data_inc);

		// 	}, globe.data_fetch_timing*1000);
		// }

		// function stop_timing(){

		// 	if(globe.interval_id == null)
		// 		return;

		// 	clearInterval(globe.interval_id);
		// 	globe.interval_id = null;

		// }

		function changemode(val){
			ContourVis.MODE = val;
			$('[ng-controller="app_controller"]').scope().masterUpdate();
		}

		function changeTension(val){
			if(parseInt(val) == 1)
				ContourVis.tension += 0.1;
			else
				ContourVis.tension -= 0.1;
			$('[ng-controller="app_controller"]').scope().masterUpdate();
		}

		function sortTree(val){
			if(parseInt(val) == 0)
				CTreeNode.SORT = CTreeNode.SORTMODE.VOLUME;
			else if(parseInt(val) == 1)
				CTreeNode.SORT = CTreeNode.SORTMODE.GEO;
			else if(parseInt(val) == 2)
				CTreeNode.SORT = CTreeNode.SORTMODE.STAT;

			DataCenter.instance().getTree().sortChildren();
			$('[ng-controller="app_controller"]').scope().masterUpdate();

		}

		function nodeSize(val){
			if(parseInt(val) == 0)
				VisComponent.SCALE = VisComponent.SCALEMODE.LOG;
			else if(parseInt(val) == 1)
				VisComponent.SCALE = VisComponent.SCALEMODE.LINEAR;
			else if(parseInt(val) == 2)
				VisComponent.SCALE = VisComponent.SCALEMODE.UNIFORM;
			else if(parseInt(val) == 3)
				VisComponent.SCALE = VisComponent.SCALEMODE.POLY;

			$('[ng-controller="app_controller"]').scope().masterUpdate();

		}

		function setNodeType(val){
			
			if(parseInt(val) == 0)
				$('[ng-controller="ScaleTreeCtrl"]').scope().getScaleTreeCanvas().NODE_TYPE = ScaleTreeCanvas.NODE_TYPE_MODE.RECT;
			else if(parseInt(val) == 1)
				$('[ng-controller="ScaleTreeCtrl"]').scope().getScaleTreeCanvas().NODE_TYPE = ScaleTreeCanvas.NODE_TYPE_MODE.CIRC;
			
			$('[ng-controller="app_controller"]').scope().masterUpdate();
		}

		function treeType(val){
			
			if(parseInt(val) == 0)
				$('[ng-controller="ScaleTreeCtrl"]').scope().getScaleTreeCanvas().TREE_TYPE = ScaleTreeCanvas.TREE_TYPE_MODE.ICICLE;
			else if(parseInt(val) == 1)
				$('[ng-controller="ScaleTreeCtrl"]').scope().getScaleTreeCanvas().TREE_TYPE = ScaleTreeCanvas.TREE_TYPE_MODE.NODELINK;
			
			$('[ng-controller="app_controller"]').scope().masterUpdate();
		}


		function changeContourFill(val){
			if(parseInt(val) == 0)
				ContourVis.CONTOUR = ContourVis.CONTOURMODE.BOUND;
			else if(parseInt(val) == 1)
				ContourVis.CONTOUR = ContourVis.CONTOURMODE.FILLSINGLE;
			else if(parseInt(val) == 2)
				ContourVis.CONTOUR = ContourVis.CONTOURMODE.FILLSEQUENTIAL;
			else if(parseInt(val) == 3)
				ContourVis.CONTOUR = ContourVis.CONTOURMODE.STATSCORE;
			
			$('[ng-controller="app_controller"]').scope().masterUpdate();
		}

	</script>

</head>
<!-- onload="init()"  -->
	<body ng-app="twittNavApp" ng-controller="app_controller">

	<div id="ScaleTreeContainer" style="left:153px;top:15px;width:720px;height:550px;position:absolute;background-color: rgba(255, 255, 255, 1.0);overflow:hidden;z-index:99;border:2px solid #999;text-align:center;">
	
	<h5 align="center" style="cursor: pointer">Multi-Scale Cluster Tree</h5>

	<!--background-color: rgba(247, 251, 255, 0.6);-->
		<div style="width:700px;height:700px;margin: 0 auto;" class="noSupportDrag">
			<div id="ScaleTreeCanvasView" style="width:700px;height:500px;" ng-controller="ScaleTreeCtrl"></div>
		</div>
	</div>

	<!--<div id="EM_Tree" style="left:50px;top:400px;width:700px;height:420px;position:absolute;background-color: rgba(247, 251, 255, 0.6);overflow:hidden;z-index:99999;border:2px solid #999;" ng-controller="EMTree_controller"></div>-->

	<div id="mapView" ng-controller="map_controller" style="left:880px;top:15px;height:1024px;width:1024px;position:absolute;z-index:999;border:2px solid #999;"></div>
	<!-- <div id="mapViewHelper" style="height:2048px;width:2048px;position:absolute;display:none;"></div> -->
	<!-- <div id="mapViewHelper" style="height:200%;width:200%;position:relative;z-index:99999;"></div> -->

	<div id="controlpanel" style="left:5px;top:15px;width:140px;height:550px;position:absolute;z-index:99999;border:2px solid #999;text-align:center;overflow-y:hidden;overflow-x:hidden;margin:0 auto;" onmouseover="$('#controlpanel').css('overflowY', 'scroll');" onmouseout="$('#controlpanel').css('overflowY', 'hidden');" ng-controller="cp_controller">
		<!-- onmouseover="$('#controlpanel').css('overflow-y', 'scroll');" onmouseout="$('#controlpanel').css('overflow-y', 'hidden');" -->
		<h4 align="center" style="cursor: pointer">Control Panel</h4>

		<h5 align="center">Filter</h5>
			<div>
				<div id="slider-range"></div>
				<div id="rangeText" style="text-align:center" align="center"><h6>range:</h6></div>
				

			</div>

		<h5 align="center">Tree Type</h5>
			<div>
				<input type="radio" name="treeType" onclick="treeType(0);" ><span>icicle</span><br>
				<input type="radio" name="treeType" onclick="treeType(1);" checked><span>node-link</span><br>

			</div>
		
		<h5 align="center">Node Style</h5>
			<div>
				<input type="radio" name="nodeType" onclick="setNodeType(0);" ><span>rect</span><br>
				<input type="radio" name="nodeType" onclick="setNodeType(1);" checked><span>circle</span><br>

			</div>
		
		<h5 align="center">Node Size</h5>
			<div>
				<input type="radio" name="nodeSize" onclick="nodeSize(0);" ><span>log</span><br>
				<input type="radio" name="nodeSize" onclick="nodeSize(1);" checked><span>linear</span><br>
				<input type="radio" name="nodeSize" onclick="nodeSize(2);" ><span>uniform</span><br>
				<input type="radio" name="nodeSize" onclick="nodeSize(3);" ><span>poly</span>

			</div>

		<h5 align="center">Sort Tree</h5>
			<div>
				<input type="radio" name="sortTree" onclick="sortTree(0);" ><span>volume</span><br>
				<input type="radio" name="sortTree" onclick="sortTree(1);" checked><span>geolocation(lon)</span><br>
				<input type="radio" name="sortTree" onclick="sortTree(2);" ><span>stat score</span>

			</div>
		
		<h5 align="center">Contour Layout</h5>
			<div>
				<input type="radio" name="mode" onclick="changemode(0);"><span>basis</span>
				<input type="radio" name="mode" onclick="changemode(1);" checked><span>cardinal</span><br>
				tension: <button onclick="changeTension(1)">+</button>
				<button onclick="changeTension(0)">-</button>
			</div>

		<h5 align="center">Contour Fill</h5>

			<div>
				<input type="radio" name="conVis" onclick="changeContourFill(0);" ><span>no fill</span><br>
				<input type="radio" name="conVis" onclick="changeContourFill(1);" ><span>single hue</span><br>
				<input type="radio" name="conVis" onclick="changeContourFill(2);" checked><span>sequential</span><br>
				<input type="radio" name="conVis" onclick="changeContourFill(3);" ><span>stat score</span><br>
			</div>


	</div>


	<div id="clusterSigContainer" style="left:5px;top:580px;width:430px;height:460px;position:absolute;background-color: rgba(255, 255, 255, 1.0);overflow:hidden;z-index:99;border:2px solid #999;text-align:center;">
	
	<h5 align="center" style="cursor: pointer">Cluster Signature</h5>

		<div style="width:400px;height:450px;margin: 0 auto;" class="noSupportDrag">
			<div id="clusterSignature" style="width:400px;height:550px;"></div>
		</div>
	</div>

	<div id="msgContainer" style="left:440px;top:580px;width:430px;height:460px;position:absolute;background-color: rgba(255, 255, 255, 1.0);overflow:hidden;z-index:99;border:2px solid #999;text-align:center;">
	
	<h5 align="center" style="cursor: pointer">Message Table</h5>

		<div style="width:400px;height:450px;margin: 0 auto;" class="noSupportDrag">
			<div id="msg" style="width:400px;height:550px;"></div>
		</div>
	</div>

</body>
</html>